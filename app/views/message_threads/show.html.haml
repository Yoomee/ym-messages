-content_for :head do
  :javascript
    $(document).ready(function(){
      YmCore.scrollTo('.message#' + "#{@last_message.id}");
      $('#more-messages-btn').click(function(){
        $(this).html("Loading...");
      });
    });

.messages-wrap.span8.offset2
  .messages-header
    %h2.messages-title
      =@message_thread.participants.without(current_user).collect(&:to_s).to_sentence
  .all-messages-strip
    =link_to messages_path, :class=>"all-messages-link" do
      %i.icon-arrow-left
      All messages
  .message-show
    -if @messages.next_page
      =link_to "Show older messages", message_thread_path(@message_thread, :page => @messages.next_page), :remote => true, :class => "btn", :id => "more-messages-btn"
    .message-inner
      =render 'message_threads/messages', :messages => @messages
  - users_without_messaging = @message_thread.participants - Message.valid_recipients_for_user(current_user)
  - users_without_messaging.delete(current_user) if !current_user.no_private_messages? || @message_thread.participants.without(current_user) == [User.elephant]  
  -if users_without_messaging.empty?
    .reply-box
      .reply-box-inner
        .reply-form
          =semantic_form_for(@message || Message.new(:thread => @message_thread)) do |form|
            =form.input :text, :label => false, :title => "Reply", :input_html => {:rows => 6, :placeholder => "Write a reply...", :class => "reply-field", :autofocus => true }
            =form.input :message_thread_id, :as => :hidden
            =form.commit_button "Reply", :button_html => {:class => "btn message-reply-btn", :'data-loading-text' => "Sending..."}
  -else
    .clearfix
    .alert
      You can't reply at the moment because
      =users_without_messaging.collect{|u| nickname_or_you(u)}.to_sentence
      =(users_without_messaging.count > 1 || users_without_messaging == [current_user]) ? 'have' : 'has'
      disabled private messaging.
